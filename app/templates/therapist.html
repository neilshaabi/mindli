{% extends 'layout.html' %}

{% block title %}
    {{ therapist.user.full_name }}
{% endblock %}

{% block content %}
    
    <div class='container'>

        <div class='row mb-4 g-4 align-items-center'>
            <div class='col-auto'>
                <h4 class="mb-0">{{ therapist.user.full_name }}<span class="my-muted">&nbsp;&nbsp;/&nbsp;&nbsp;Therapist</span></h4>
            </div>
            <div class="col-auto ms-auto">
                <div class="row">
                    <div class="col-auto">
                        <a href="{{ url_for('therapists.index') }} ">
                            <i class="fa-solid fa-chevron-left"></i>
                            Therapist directory
                        </a>
                    </div>
                    <div class="col-auto">
                        {% set status = 'Active' if therapist.user.active else 'Inactive' %}
                        <div>{{ tag(label=status, status=status, with_icon=True, additional_class='tag-lg') }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row g-4">
            
            <div class="col-lg-3">
                <div class="my-card p-4">
                    
                    <ul class="list-group list-group-flush" id="section-selector" data-default-section="{{ default_section }}">
                        
                        <li class="list-group-item list-group-item-action" data-target="#profile">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    Therapist Profile
                                </div>
                                <div class="col-auto ms-auto">
                                    <i class="fa-solid fa-user"></i>
                                </div>
                            </div>
                        </li>
                        
                        {% if therapist.is_current_user %}
                            
                            <li class="list-group-item list-group-item-action" data-target="#edit-profile">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        Edit Profile
                                    </div>
                                    <div class="col-auto ms-auto">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </div>
                                </div>
                            </li>

                            <li class="list-group-item list-group-item-action" data-target="#appointment-types">
                                <div class="row align-items-center">
                                    <div class="col-auto">Appointment Types</div>
                                    <div class="col-auto ms-auto">{{ tag(label=therapist.active_appointment_types|length|string, additional_class='tag-sm') }}</div>
                                </div>
                            </li>

                            <li class="list-group-item list-group-item-action" data-target="#settings">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        Settings
                                    </div>
                                    <div class="col-auto ms-auto">
                                        <i class="fa-solid fa-gear"></i>
                                    </div>
                                </div>
                            </li>

                        {% elif current_user.role == UserRole.CLIENT %}

                            <li class="list-group-item list-group-item-action" data-target="#booking">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        Book Appointment
                                    </div>
                                    <div class="col-auto ms-auto">
                                        <i class="fa-regular fa-calendar-plus"></i>
                                    </div>
                                </div>
                            </li>
                            
                        {% endif %}
                    </ul>
                </div>
            </div>
            
            <div class="col-lg-9">
                <div class="my-card">
                    
                    <!-- Therapist profile section-->
                    <div id="profile" class="section">
                        <div class="row mb-3">
                            <div class="col-12">
                                
                                <!-- Header -->
                                <div class="row g-4 mb-4 align-items-center">
                                    <div class="col-auto">
                                        <a href="{{ url_for('therapists.therapist', therapist_id=therapist.id) }}">
                                            <img src="{{ url_for('static', filename='img/profile_pictures/' + therapist.user.profile_picture) }}" class="profile-picture" alt="Profile picture of {{ therapist.user.full_name }}">
                                        </a>
                                    </div>
                                    <div class="col">
                                        <div class="row">
                                            <h5 class="mb-1">
                                                <a href="{{ url_for('therapists.therapist', therapist_id=therapist.id) }}">
                                                    {{ therapist.user.full_name }}
                                                </a>
                                            </h5>
                                        </div>
                                        <div class="row">
                                            <span class="text-muted">{{ therapist.titles|join(', ', 'name') }}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <hr>

                                <!-- Body -->
                                <div class="mt-4">
                                    <div class="accordion accordion-flush" id="profileAccordion">

                                        <!-- Personal details -->
                                        <div class="accordion-item row">
                                            <div class="col-12">
                                    
                                                <div class="accordion-header row">
                                                    <div class="col-12">
                                                        <h6 class="mb-0">
                                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#personalDetailsCollapse" aria-expanded="false" aria-controls="personalDetailsCollapse">
                                                            Personal details
                                                            </button>
                                                        </h6>
                                                    </div>
                                                </div>
                    
                                                <div id="personalDetailsCollapse" class="accordion-collapse collapse show text-s" data-bs-parent="#profileAccordion">

                                                    <div class="accordion-body">
                                                    
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Gender</div>
                                                                <div>{{ therapist.user.gender.value }}</div>
                                                            </div>
                                                        </div>
                        
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Based in</div>
                                                                <div>{{ therapist.country if therapist.country else '' }}</div>
                                                            </div>
                                                        </div>
                        
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Languages spoken</div>
                                                                <div>{{ therapist.languages|join(', ', 'name') }}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Professional experience -->
                                        <div class="accordion-item row">
                                            <div class="col-12">
                                    
                                                <div class="accordion-header row">
                                                    <div class="col-12">
                                                        <h6 class="mb-0">
                                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#professionalExperienceCollapse" aria-expanded="false" aria-controls="professionalExperienceCollapse">
                                                                Professional experience
                                                            </button>
                                                        </h6>
                                                    </div>
                                                </div>
                    
                                                <div id="professionalExperienceCollapse" class="accordion-collapse collapse text-s" data-bs-parent="#profileAccordion">

                                                    <div class="accordion-body">
                                                    
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Years of experience</div>
                                                                <div>{{ therapist.years_of_experience|string + ' years' if therapist.years_of_experience else '' }}</div>
                                                            </div>
                                                        </div>

                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Qualifications</div>
                                                                <div>{{ therapist.qualifications if therapist.qualifications else '' }}</div>
                                                            </div>
                                                        </div>

                                                        {% if therapist.registrations %}
                                                            <div class="row mb-3">
                                                                <div class="col-12">
                                                                    <div class="mb-1 my-muted">Registrations</div>
                                                                    <div>{{ therapist.registrations }}</div>
                                                                </div>
                                                            </div>
                                                        {% endif %}

                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="row mb-1 my-muted">
                                                                    <div class="col-12">Specialisations</div>
                                                                </div>
                                                                <div class="row g-1">
                                                                    {% for specialisation in therapist.specialisations %}
                                                                        <div class="col-auto">{{ tag(label=specialisation.name) }}</div>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="row mb-1 my-muted">
                                                                    <div class="col-12">Interventions</div>
                                                                </div>
                                                                <div class="row g-1">
                                                                    {% for intervention in therapist.interventions %}
                                                                        <div class="col-auto">{{ tag(label=intervention.name) }}</div>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {% if therapist.link %}
                                                            <div class="row mb-3">
                                                                <div class="col-12">
                                                                    <div class="mb-1 my-muted">Website</div>
                                                                    <div><a href="{{ therapist.link }}">{{ therapist.link }}</a></div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Appointment details -->
                                        <div class="accordion-item row">
                                            <div class="col-12">
                                    
                                                <div class="accordion-header row">
                                                    <div class="col-12">
                                                        <h6 class="mb-0">
                                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#appointmentDetailsCollapse" aria-expanded="false" aria-controls="appointmentDetailsCollapse">
                                                            Appointment details
                                                            </button>
                                                        </h6>
                                                    </div>
                                                </div>
                    
                                                <div id="appointmentDetailsCollapse" class="accordion-collapse collapse text-s" data-bs-parent="#profileAccordion">

                                                    <div class="accordion-body">
                                                    
                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="row mb-1 my-muted">
                                                                    <div class="col-12">Therapy types offered</div>
                                                                </div>
                                                                <div class="row g-1">
                                                                    {% for therapy_type in therapist.active_appointment_types|map(attribute='therapy_type')|unique %}
                                                                        <div class="col-auto">{{ tag(label=therapy_type.value, status=therapy_type.name, with_icon=True) }}</div>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="row mb-1 my-muted">
                                                                    <div class="col-12">Modes supported</div>
                                                                </div>
                                                                <div class="row g-1">
                                                                    {% for therapy_mode in therapist.active_appointment_types|map(attribute='therapy_mode')|unique %}
                                                                        <div class="col-auto">{{ tag(label=therapy_mode.value, status=therapy_mode.name, with_icon=True) }}</div>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {% if therapist.location %}
                                                            <div class="row mb-3">
                                                                <div class="col-12">
                                                                    <div class="mb-1 my-muted">Location (in-person appointments)</div>
                                                                    <div>{{ therapist.location }}</div>
                                                                </div>
                                                            </div>
                                                        {% endif %}

                                                        <div class="row mb-3">
                                                            <div class="col-12">
                                                                <div class="mb-1 my-muted">Durations</div>
                                                                <div>{{ therapist.active_appointment_types|map(attribute='duration')|unique|sort|join(' minutes, ') + ' minutes' if therapist.appointment_types else '' }} </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    {% if therapist.is_current_user %}
                        
                        <!-- Edit profile section-->
                        <div id="edit-profile" class="section">
                            <div class="row mb-3">
                                <div class="col-12">
                                    
                                    <!-- Header -->
                                    <div class="row mb-4 align-items-center">
                                        <div class="col-auto">
                                            <h5 class="mb-0">Edit Profile</h5>
                                        </div>
                                    </div>

                                    <hr>

                                    <!-- Body -->
                                    <div class="mt-4">

                                        <div class="accordion accordion-flush" id="editProfileAccordion">
    
                                            <!-- Edit personal details -->
                                            <div class="accordion-item row">
                                                <div class="col-12">
                                        
                                                    <div class="accordion-header row">
                                                        <div class="col-12">
                                                            <h6 class="mb-0">
                                                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#editPersonalDetailsCollapse" aria-expanded="false" aria-controls="editPersonalDetailsCollapse">
                                                                    Personal details
                                                                </button>
                                                            </h6>
                                                        </div>
                                                    </div>
                        
                                                    <div id="editPersonalDetailsCollapse" class="accordion-collapse collapse show text-s">
    
                                                        <div class="accordion-body">

                                                            <form id="{{ forms.user_profile_form.id }}" action="{{ forms.user_profile_form.endpoint }}" novalidate>
                                            
                                                                {{ forms.user_profile_form.csrf_token }}

                                                                <div class="row g-5 align-items-center">
                                                                    
                                                                    <div class="col-auto">
                                                                        <div id="profile-picture-container">
                                                                            <img id="profile-picture-preview" src="{{ url_for('static', filename='img/profile_pictures/' + current_user.profile_picture) }}" alt="Profile picture">
                                                                            <label for="profile_picture" class="btn btn-primary" id="profile-picture-upload">
                                                                                <i class="fa fa-camera"></i>
                                                                            </label>
                                                                            {{ forms.user_profile_form.profile_picture(style='display: none;') }}
                                                                        </div>
                                                                    </div>

                                                                    <div class="col">
                                                                        
                                                                        <div class="row g-2">
                                                                            <div class="col-md-3">
                                                                                <div class='form-floating'>
                                                                                    {{ forms.user_profile_form.first_name(class_='form-control', placeholder=forms.user_profile_form.first_name.label.text) }}
                                                                                    {{ forms.user_profile_form.first_name.label }}
                                                                                </div>
                                                                            </div>
                                            
                                                                            <div class="col-md-3">
                                                                                <div class='form-floating'>
                                                                                    {{ forms.user_profile_form.last_name(class_='form-control', placeholder=forms.user_profile_form.last_name.label.text) }}
                                                                                    {{ forms.user_profile_form.last_name.label }}
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-3">
                                                                                <div class='form-floating'>
                                                                                    {{ forms.user_profile_form.gender(class_='form-control', placeholder=forms.user_profile_form.gender.label.text) }}
                                                                                    {{ forms.user_profile_form.gender.label }}
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-3">
                                                                                {{ submit_button(forms.user_profile_form.submit) }}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Edit professional experience -->
                                            <div class="accordion-item row">
                                                <div class="col-12">
                                        
                                                    <div class="accordion-header row">
                                                        <div class="col-12">
                                                            <h6 class="mb-0">
                                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#editProfessionalExperienceCollapse" aria-expanded="false" aria-controls="editProfessionalExperienceCollapse">
                                                                    Professional experience
                                                                </button>
                                                            </h6>
                                                        </div>
                                                    </div>
                        
                                                    <div id="editProfessionalExperienceCollapse" class="accordion-collapse collapse text-s">
    
                                                        <div class="accordion-body">

                                                            <form id="{{ forms.therapist_profile_form.id }}" action="{{ forms.therapist_profile_form.endpoint }}" novalidate>

                                                                {{ forms.therapist_profile_form.csrf_token }}
                                                        
                                                                <div class="row mb-3 g-2">
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.titles(class_='form-control', placeholder=forms.therapist_profile_form.titles.label.text) }}
                                                                            {{ forms.therapist_profile_form.titles.label }}
                                                                        </div>
                                                                    </div>
                                    
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.years_of_experience(class_='form-control', placeholder=forms.therapist_profile_form.years_of_experience.label.text) }}
                                                                            {{ forms.therapist_profile_form.years_of_experience.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                    
                                                                <div class="row mb-3">
                                                                    <div class="col-12">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.qualifications(class_='form-control', placeholder=forms.therapist_profile_form.qualifications.label.text) }}
                                                                            {{ forms.therapist_profile_form.qualifications.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="row mb-3">
                                                                    <div class="col-12">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.registrations(class_='form-control', placeholder=forms.therapist_profile_form.registrations.label.text) }}
                                                                            {{ forms.therapist_profile_form.registrations.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="row mb-3 g-2">
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.issues(class_='form-control', placeholder=forms.therapist_profile_form.issues.label.text) }}
                                                                            {{ forms.therapist_profile_form.issues.label }}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.interventions(class_='form-control', placeholder=forms.therapist_profile_form.interventions.label.text) }}
                                                                            {{ forms.therapist_profile_form.interventions.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="row mb-3 g-2">
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.country(class_='form-control', placeholder=forms.therapist_profile_form.country.label.text) }}
                                                                            {{ forms.therapist_profile_form.country.label }}
                                                                        </div>
                                                                    </div>
                                    
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.languages(class_='form-control', placeholder=forms.therapist_profile_form.languages.text) }}
                                                                            {{ forms.therapist_profile_form.languages.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="row mb-3 g-2">
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.location(class_='form-control', placeholder=forms.therapist_profile_form.location.label.text) }}
                                                                            {{ forms.therapist_profile_form.location.label }}
                                                                        </div>
                                                                    </div>
                                    
                                                                    <div class="col-md-6">
                                                                        <div class='form-floating'>
                                                                            {{ forms.therapist_profile_form.link(class_='form-control', placeholder=forms.therapist_profile_form.link.label.text) }}
                                                                            {{ forms.therapist_profile_form.link.label }}
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="row mb-3">
                                                                    <div class="col-12">
                                                                        {{ submit_button(forms.therapist_profile_form.submit) }}
                                                                    </div>
                                                                </div>
                                                            
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Appointment types -->
                        <div id="appointment-types" class="section">
                            <div class="row mb-3">
                                <div class="col-12">
                                    
                                    <!-- Header -->
                                    <div class="row mb-4 align-items-center">
                                        <div class="col-auto">
                                            <h5 class="mb-0">Appointment Types</h5>
                                        </div>
                                    </div>

                                    <hr>

                                    <!-- Body -->
                                    <div class="mt-4">

                                        <div class="accordion accordion-flush" id="appointmentTypesAccordion">

                                            <!-- New appointment type form -->
                                            <div class="accordion-item row">
                                                <div class="col-12">
                                        
                                                    <div class="accordion-header row">
                                                        <div class="col-12">
                                                            <h6 class="mb-0">
                                                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#newAppointmentTypeCollapse" aria-expanded="false" aria-controls="newAppointmentTypeCollapse">
                                                                    New appointment type
                                                                </button>
                                                            </h6>
                                                        </div>
                                                    </div>
                        
                                                    <div id="newAppointmentTypeCollapse" class="accordion-collapse collapse show text-s" data-bs-parent="#appointmentTypesAccordion">
                                                        <div class="accordion-body">
                                                            
                                                            <form id="{{ forms.create_appt_type_form.id }}" action="{{ forms.create_appt_type_form.endpoint }}" novalidate>
                                            
                                                                {{ forms.create_appt_type_form.csrf_token }}
                                                            
                                                                <div class="row g-2 align-items-center">
                                                                    
                                                                    <div class="col-lg-auto">
                                                                        <div class='form-floating'>
                                                                            {{ forms.create_appt_type_form.therapy_type(class_='form-control', placeholder=forms.create_appt_type_form.therapy_type.label.text, form=forms.create_appt_type_form.id) }}
                                                                            {{ forms.create_appt_type_form.therapy_type.label }}
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-lg-auto">
                                                                        <div class='form-floating'>
                                                                            {{ forms.create_appt_type_form.therapy_mode(class_='form-control', placeholder=forms.create_appt_type_form.therapy_mode.label.text, form=forms.create_appt_type_form.id) }}
                                                                            {{ forms.create_appt_type_form.therapy_mode.label }}
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-lg-auto">
                                                                        <div class='form-floating'>
                                                                            {{ forms.create_appt_type_form.duration(class_='form-control', placeholder=forms.create_appt_type_form.duration.label.text, form=forms.create_appt_type_form.id) }}
                                                                            {{ forms.create_appt_type_form.duration.label }}
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-lg-auto">
                                                                        <div class='form-floating'>
                                                                            {{ forms.create_appt_type_form.fee_currency(class_='form-control', placeholder=forms.create_appt_type_form.fee_currency.label.text, form=forms.create_appt_type_form.id) }}
                                                                            {{ forms.create_appt_type_form.fee_currency.label }}
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-lg-auto">
                                                                        <div class='form-floating'>
                                                                            {{ forms.create_appt_type_form.fee_amount(class_='form-control', placeholder=forms.create_appt_type_form.fee_amount.label.text, form=forms.create_appt_type_form.id) }}
                                                                            {{ forms.create_appt_type_form.fee_amount.label }}
                                                                        </div>
                                                                    </div>

                                                                    <!-- Buttons -->
                                                                    <div class="col-lg-auto">
                                                                        <div class="row">

                                                                            <!-- Add appointment type button -->
                                                                            <div class="col-lg-auto">
                                                                                {{ submit_button(form=forms.create_appt_type_form.id, label='Add')}}
                                                                            </div>
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
    
                                            <!-- Accordion item for each appointment type -->
                                            {% for form in forms.update_appt_type_forms %}
                                                <div class="accordion-item row">
                                                    <div class="col-12">
                                            
                                                        <div class="accordion-header row">
                                                            <div class="col-12">
                                                                <h6 class="mb-0">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#appointmentTypeCollapse{{ loop.index }}" aria-expanded="false" aria-controls="appointmentTypeCollapse{{ loop.index }}">
                                                                        {{ TherapyType[form.therapy_type.data].value }}, {{ TherapyMode[form.therapy_mode.data].value }} ({{ form.duration.data }} minutes) - {{ form.fee_currency.data }} {{ form.fee_amount.data }}
                                                                    </button>
                                                                </h6>
                                                            </div>
                                                        </div>
                            
                                                        <div id="appointmentTypeCollapse{{ loop.index }}" class="accordion-collapse collapse text-s" data-bs-parent="#appointmentTypesAccordion">
                                                            <div class="accordion-body">
                                                                
                                                                <form id="{{ form.id }}" action="{{ form.endpoint }}" novalidate>

                                                                    {{ form.csrf_token }}

                                                                    <div class="row g-2 align-items-center">
                                                                        
                                                                        <div class="col-lg-auto">
                                                                            <div class='form-floating'>
                                                                                {{ form.therapy_type(class_='form-control', placeholder=form.therapy_type.label.text, form=form.id, disabled=True) }}
                                                                                {{ form.therapy_type.label }}
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-lg-auto">
                                                                            <div class='form-floating'>
                                                                                {{ form.therapy_mode(class_='form-control', placeholder=form.therapy_mode.label.text, form=form.id, disabled=True) }}
                                                                                {{ form.therapy_mode.label }}
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-lg-auto">
                                                                            <div class='form-floating'>
                                                                                {{ form.duration(class_='form-control', placeholder=form.duration.label.text, form=form.id, disabled=True) }}
                                                                                {{ form.duration.label }}
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-lg-auto">
                                                                            <div class='form-floating'>
                                                                                {{ form.fee_currency(class_='form-control', placeholder=form.fee_currency.label.text, form=form.id, disabled=True) }}
                                                                                {{ form.fee_currency.label }}
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-lg-auto">
                                                                            <div class='form-floating'>
                                                                                {{ form.fee_amount(class_='form-control', placeholder=form.fee_amount.label.text, form=form.id, disabled=True) }}
                                                                                {{ form.fee_amount.label }}
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <div class="col-lg-auto">
                                                                            <div class="row g-2">
                                                                                <!-- Edit appointment type button -->
                                                                                <div class="col-lg-auto">
                                                                                    <button type="button" form="{{ form.id }}" class="btn btn-primary enable-form-btn">Edit</button>
                                                                                </div>
                                                                                
                                                                                <!-- Save changes button -->
                                                                                <div class="col-lg-6 hidden">
                                                                                    <button type="submit" form="{{ form.id }}" class="btn btn-primary">Save</button>
                                                                                </div>

                                                                                <!-- Delete appointment type button -->
                                                                                <div class="col-lg-6 hidden" form="{{ form.id }}" data-bs-toggle="modal" data-bs-target="#deleteAppointmentTypeModal">
                                                                                    <button type="button" form="{{ form.id }}" class="btn btn-danger">Delete</button>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Settings section-->
                        <div id="settings" class="section">
                            <div class="row mb-3">
                                <div class="col-12">
                                    
                                    <!-- Header -->
                                    <div class="row mb-4 align-items-center">
                                        <div class="col-auto">
                                            <h5 class="mb-0">Settings</h5>
                                        </div>
                                    </div>
                                    
                                    <hr>

                                    <!-- Body -->
                                    <div class="mt-4">
                                        <div class="accordion accordion-flush" id="settingsAccordion">

                                            <!-- Payment setup -->
                                            <div class="accordion-item row">
                                                <div class="col-12">
                                        
                                                    <div class="accordion-header row">
                                                        <div class="col-12">
                                                            <h6 class="mb-0">
                                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paymentsCollapse" aria-expanded="false" aria-controls="paymentsCollapse">
                                                                Payments
                                                                </button>
                                                            </h6>
                                                        </div>
                                                    </div>
                        
                                                    <div id="paymentsCollapse" class="accordion-collapse collapse text-s">

                                                        <div class="accordion-body">
                                                            
                                                            <div class="row mb-3">
                                                                <div class="my-muted text-s">
                                                                    <i class="fa-solid fa-circle-info"></i>
                                                                    mindli partners with <a href="stripe.com">Stripe</a> for secure payments
                                                                </div>
                                                            </div>
                                                            
                                                            {% if therapist.stripe_account_id %}
                                                                
                                                            <div class="row mb-3">
                                                                    <div class="col-12">
                                                                        <div class="mb-1 my-muted">Stripe onboarding</div>
                                                                        <div>{{ tag(status='Completed', label='Completed', with_icon=True) }}</div>
                                                                    </div>
                                                                </div>

                                                                <div class="row mb-3">
                                                                    <div class="col-12">
                                                                        <div class="mb-1 my-muted">Payment history</div>
                                                                        <div>Visit the <a href="https://dashboard.stripe.com">Stripe dashboard</div>
                                                                    </div>
                                                                </div>
                                                            
                                                            {% else %}
                                                                
                                                                <form id="{{ forms.stripe_onboarding_form.id }}" action="{{ forms.stripe_onboarding_form.endpoint }}" novalidate>
                                                                    
                                                                    {{ forms.stripe_onboarding_form.csrf_token }}

                                                                    <div class="row">
                                                                        <div class="col-12">
                                                                            <div class="mb-3 my-muted">
                                                                                Complete onboarding to start receiving payments via Stripe
                                                                            </div>
                                                                            <div class="row mb-3">
                                                                                <div class="col-auto">
                                                                                    {{ submit_button(forms.stripe_onboarding_form.submit) }}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            {% endif %}

                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                            <!-- TODO -->
                                            <div class="accordion-item row">
                                                <div class="col-12">
                                        
                                                    <div class="accordion-header row">
                                                        <div class="col-12">
                                                            <h6 class="mb-0">
                                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#TODO" aria-expanded="false" aria-controls="TODO">
                                                                TODO
                                                                </button>
                                                            </h6>
                                                        </div>
                                                    </div>
                        
                                                    <div id="TODO" class="accordion-collapse collapse text-s">

                                                        <div class="accordion-body">

                                                            TODO
                                                            
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Appointment booking section-->
                    {% if current_user.role == UserRole.CLIENT %}
                        <div id="booking" class="section">
                            <div class="row">
                                <div class="col-12">
                                    
                                    <!-- Header -->
                                    <div class="row g-4 mb-4 align-items-center">
                                        <div class="col-auto">
                                            <img src="{{ url_for('static', filename='img/profile_pictures/' + therapist.user.profile_picture) }}" class="profile-picture" alt="Profile picture of {{ therapist.user.full_name }}">
                                        </div>
                                        <div class="col">
                                            <div class="row">
                                                <h5 class="mb-1">{{ therapist.user.full_name }}</h5>
                                            </div>
                                            <div class="row">
                                                <span class="text-muted">{{ therapist.titles|join(', ', 'name') }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <hr>

                                    <!-- Body -->
                                    <div class="mt-4">
                                        
                                        <div class="row mb-4">
                                            <div class="col-12">
                                                <h6 class="mb-0">
                                                    Schedule appointment
                                                </h6>
                                            </div>
                                        </div>

                                        <form id="{{ forms.book_appointment_form.id }}" action="{{ forms.book_appointment_form.endpoint }}" novalidate>

                                            {{ forms.book_appointment_form.csrf_token }}

                                            <div class="row mb-3">
                                                <div class="col-12">
                                                    <div class='form-floating'>
                                                        {{ forms.book_appointment_form.appointment_type(class_='form-control', placeholder=forms.book_appointment_form.appointment_type.label.text) }}
                                                        {{ forms.book_appointment_form.appointment_type.label }}
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <div class="row mb-3 g-2">
                                                <div class="col-md-4">
                                                    <div class='form-floating'>
                                                        {{ forms.book_appointment_form.date(class_='form-control', placeholder=forms.book_appointment_form.date.label.text) }}
                                                        {{ forms.book_appointment_form.date.label }}
                                                    </div>
                                                </div>
                    
                                                <div class="col-md-4">
                                                    <div class='form-floating'>
                                                        {{ forms.book_appointment_form.time(class_='form-control', placeholder=forms.book_appointment_form.time.label.text) }}
                                                        {{ forms.book_appointment_form.time.label }}
                                                    </div>
                                                </div>
                                                
                                                <div class="col-md-4">
                                                    {{ submit_button(forms.book_appointment_form.submit) }}
                                                </div>
                                            </div>
                                        
                                        </form>
                                    
                                        <div class="my-muted text-s">
                                            <i class="fa-solid fa-circle-info"></i>
                                            Please <a href="TODO">message</a> your therapist to confirm these details before proceeding
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>

    {% if therapist.is_current_user and therapist.appointment_types %}
        <!-- Modal to delete an appointment type -->
        <div class="modal fade" id="deleteAppointmentTypeModal" tabindex="-1" aria-labelledby="deleteAppointmentTypeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="deleteAppointmentTypeModalLabel">Confirm deletion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this appointment type?
                        <strong>Warning:</strong> this action cannot be undone.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <form id="{{ forms.delete_appt_type_form.id }}" action="{{ forms.delete_appt_type_form.endpoint }}" novalidate>
                            {{ forms.delete_appt_type_form.csrf_token }}
                            {{ forms.delete_appt_type_form.appointment_type_id }}
                            {{ submit_button(forms.delete_appt_type_form.submit, class='btn btn-danger') }}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
