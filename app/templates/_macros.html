{% macro submit_button(submit_field, id=None, class=None, disabled=False) %}
    <button type="submit" 
    id="{% if id %}{{ id }}{% endif %}"
    class="{% if class %}{{ class }}{% else %}btn btn-primary{% endif %}"
    {% if disabled %}disabled{% endif %}
        {% if submit_field.render_kw %}
            {% if submit_field.render_kw.name %} name={{ submit_field.render_kw['name'] }} {% endif %}
            {% if submit_field.render_kw.value %} value={{ submit_field.render_kw['value'] }} {% endif %}
        {% endif %}>
        <span class="btn-text">{{ submit_field.label.text }}</span>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
        <span class="visually-hidden">Loading...</span>
    </button>
{% endmacro %}


{% macro therapist_card(therapist) %}
    <div class="col-lg-6">
        <div class="my-card therapist-card">
            <div class="row mb-3">
                <div class="col-2">
                    <img src="{{ url_for('static', filename='img/profile_pictures/' + therapist.user.profile_picture) }}" class="profile-pic" alt="Profile picture of {{ therapist.user.full_name }}">
                </div>
                <div class="col-10 ps-4">
                    <h5>{{ therapist.user.full_name }}</h5>
                    <span class="text-muted">{{ therapist.qualifications }}</span>
                </div>
            </div>
            <div>
                <p class="p-0">Types: {{ therapist.active_appointment_types|map(attribute='therapy_type.value')|unique|join(', ') }}</p>
                <p class="p-0">Modes: {{ therapist.active_appointment_types|map(attribute='therapy_mode.value')|unique|join(', ') }}</p>
                <p class="p-0">Titles: {{ therapist.titles|join(', ', 'name') }}</p>
                <p class="p-0">Gender: {{ therapist.user.gender.value }}</p>
                <p class="p-0">Languages: {{ therapist.languages|join(', ', 'name') }}</p>
                <p class="p-0">Based in: {{ therapist.country }}</p>
                <p class="p-0">Years of Experience: {{ therapist.years_of_experience }}</p>
                <p class="p-0">Specialisations: {{ therapist.specialisations|join(', ', 'name') }}</p>
                <p class="p-0">Interventions: {{ therapist.interventions|join(', ', 'name') }}</p>
                <a href="{{ url_for('therapist_directory.therapist', therapist_id=therapist.id) }}" class="btn btn-primary">View Profile</a>
            </div>
        </div>
    </div>
{% endmacro %}


{% macro flashed_message(message, category) %}
    {% set class_map = {
        'success': ('alert-success', 'fa-solid fa-circle-check'),
        'error': ('alert-danger', 'fa-solid fa-circle-exclamation'),
        'warning': ('alert-warning', 'fa-solid fa-triangle-exclamation'),
        'info': ('alert-info', 'fa-solid fa-circle-info')
    } %}
    {% set alert_class, icon_class = class_map.get(category, ('alert-primary', 'fa-solid fa-circle-info')) %}
    
    <div class="alert {{ alert_class }} alert-dismissible fade show" role='alert'>
        <i class="{{ icon_class }}"></i> {{ message }}
        <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>
    </div>
{% endmacro %}

{% macro tag(label='', status='', with_icon=False, additional_class='') %}
    {% set tag_map = {
        
        'not_set': ('bg-primary-subtle text-primary-emphasis', 'fa-regular fa-note-sticky'),
        'incomplete': ('bg-warning-subtle text-warning-emphasis', 'fa-solid fa-exclamation'),
        
        'scheduled': ('bg-info-subtle text-info-emphasis', 'fa-regular fa-clock'),
        'confirmed': ('bg-primary-subtle text-primary-emphasis', 'fa-regular fa-calendar-check'),
        'completed': ('bg-success-subtle text-success-emphasis', 'fa-solid fa-check'),
        'rescheduled': ('bg-warning-subtle text-warning-emphasis', 'fa-solid fa-rotate'),
        'cancelled': ('bg-danger-subtle text-danger-emphasis', 'fa-solid fa-xmark'),
        'no_show': ('bg-danger-subtle text-danger-emphasis', 'fa-solid fa-ban'),

        'pending': ('bg-warning-subtle text-warning-emphasis', 'fa-regular fa-clock'),
        'succeeded': ('bg-success-subtle text-success-emphasis', 'fa-solid fa-check'),
        'failed': ('bg-danger-subtle text-danger-emphasis', 'fa-solid fa-xmark')
    } %}
    {% set class, icon_class = tag_map.get(status.lower(), ('bg-light-subtle text-light-emphasis', None)) %}
    <span class="tag {{ class }} {{ additional_class }}">
        {% if icon_class and with_icon %}
            <i class="{{ icon_class }}" style="font-size:small;"></i>
        {% endif %}
        {{ label }}
    </span>
{% endmacro %}
